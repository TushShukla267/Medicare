import React, { useState } from 'react';
import {
  Heart, Activity, Users, Calendar, Bell, Settings, LogOut, Menu, X, Phone,
  Video, FileText, TrendingUp, AlertCircle, Clock, User, Stethoscope, Shield,
  UserPlus, ChevronRight, Thermometer, Pill, ClipboardList
} from 'lucide-react';
import VideoStream from './VideoStream';


// Mock imports - replace with actual paths
const Telemedicine = ({ userRole }: any) => <div>Telemedicine Component</div>;
const AppointmentScheduler = ({ onBook }: any) => <div>Appointment Scheduler</div>;
const AppointmentReceiver = ({ doctorId }: any) => <div>Appointment Receiver</div>;
const NavItem = ({ icon, label, active, onClick, compact }: any) => (
  <button
    onClick={onClick}
    className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${
      active ? 'bg-blue-500 text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'
    } ${compact ? 'justify-center' : ''}`}
  >
    {icon}
    {!compact && <span>{label}</span>}
  </button>
);
const PatientPortal = () => <div>Patient Portal</div>;
const ApmtLog = () => <div>Appointment Log</div>;


type Role = 'patient' | 'doctor' | 'admin' | 'guardian' | null;


const patientData = {
  name: "John Doe",
  age: 45,
  bloodType: "O+",
  appointments: [
    { id: 1, doctor: "Dr. Sarah Johnson", specialty: "Cardiology", date: "Nov 5, 2025", time: "10:30 AM", status: "upcoming" },
    { id: 2, doctor: "Dr. Michael Chen", specialty: "General Practice", date: "Oct 28, 2025", time: "2:00 PM", status: "completed" }
  ],
  vitals: {
    heartRate: 72,
    bloodPressure: "120/80",
    temperature: 98.6,
    oxygen: 98
  },
  medications: [
    { name: "Lisinopril", dosage: "10mg", frequency: "Once daily", prescribed: "Dr. Sarah Johnson" },
    { name: "Metformin", dosage: "500mg", frequency: "Twice daily", prescribed: "Dr. Michael Chen" }
  ]
};


const doctorData = {
  name: "Dr. Sarah Johnson",
  specialty: "Cardiology",
  id: 1,
  appointments: [
    { id: 1, patient: "John Doe", time: "10:30 AM", condition: "Hypertension Follow-up", status: "upcoming" },
    { id: 2, patient: "Emma Wilson", time: "11:15 AM", condition: "Chest Pain", status: "upcoming" },
    { id: 3, patient: "Michael Brown", time: "2:00 PM", condition: "Annual Checkup", status: "completed" }
  ],
  stats: {
    todayPatients: 8,
    pendingReports: 5,
    totalPatients: 156,
    rating: 4.8
  }
};


const adminData = {
  name: "Admin User",
  stats: {
    totalDoctors: 24,
    totalPatients: 1247,
    appointments: 89,
    revenue: 45678
  },
  recentActivity: [
    { type: "registration", user: "Dr. James Wilson", time: "2 hours ago" },
    { type: "appointment", user: "Patient #1245", time: "3 hours ago" },
    { type: "report", user: "Lab Report Generated", time: "5 hours ago" }
  ]
};


const guardianData = {
  name: "Jane Doe",
  dependents: [
    { name: "Emma Doe", age: 10, relation: "Daughter", lastVisit: "Oct 15, 2025", nextAppointment: "Nov 10, 2025" },
    { name: "Robert Doe", age: 70, relation: "Father", lastVisit: "Oct 20, 2025", nextAppointment: "Nov 5, 2025" }
  ]
};


type UnifiedDashboardProps = {
  userRole: Role;
};


export default function HealthcareDashboard({ userRole }: UnifiedDashboardProps) {
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [activeSection, setActiveSection] = useState('overview');
  const [darkMode, setDarkMode] = useState(false);


  if (!userRole) return <div className="p-8">Loading...</div>;


  const roleColors = {
    patient: 'from-blue-500 to-cyan-600',
    doctor: 'from-emerald-500 to-teal-600',
    admin: 'from-purple-500 to-pink-600',
    guardian: 'from-orange-500 to-amber-600'
  };


  const getRoleData = () => {
    switch (userRole) {
      case 'patient': return patientData;
      case 'doctor': return doctorData;
      case 'admin': return adminData;
      case 'guardian': return guardianData;
      default: return null;
    }
  };


  return (
    <div className={`fixed inset-0 min-h-screen w-screen overflow-auto
      ${darkMode ? 'bg-gray-900 text-gray-100' : 'bg-gradient-to-br from-gray-50 to-gray-100 text-gray-900'}
      transition-colors duration-700 z-50 font-sans`}>


      {/* Sidebar */}
      <aside className={`fixed left-0 top-0 h-full ${darkMode ? 'bg-gray-900' : 'bg-white'}
        shadow-2xl transition-all duration-400 z-40 flex flex-col
        ${sidebarOpen ? 'w-64' : 'w-20'}`}>
        <div className="p-6 flex flex-col justify-between h-full">
          <div>
            <div className="flex items-center justify-between mb-10">
              <div
                className="flex items-center gap-3 cursor-pointer select-none"
                onClick={() => setSidebarOpen((open) => !open)}
                tabIndex={0}
                role="button"
                title="Toggle sidebar"
              >
                <div className={`w-12 h-12 rounded-2xl bg-gradient-to-r ${roleColors[userRole]} flex items-center justify-center shadow-lg`}>
                  <Heart className="text-white" size={28} />
                </div>
                {sidebarOpen && (
                  <span className={`font-extrabold text-2xl tracking-wide ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                    HealthCare
                  </span>
                )}
              </div>
            </div>
            <nav className="space-y-3">
              {userRole === 'patient' && (
                <>
                  <NavItem icon={<Activity />} label="Overview" active={activeSection === 'overview'}
                    onClick={() => setActiveSection('overview')} compact={!sidebarOpen} />
                  <NavItem icon={<Calendar />} label="Appointments" active={activeSection === 'appointments'}
                    onClick={() => setActiveSection('appointments')} compact={!sidebarOpen} />
                  <NavItem icon={<Pill />} label="Medications" active={activeSection === 'medications'}
                    onClick={() => setActiveSection('medications')} compact={!sidebarOpen} />
                  <NavItem icon={<FileText />} label="Records" active={activeSection === 'records'}
                    onClick={() => setActiveSection('records')} compact={!sidebarOpen} />
                  <NavItem icon={<Video />} label="Telemedicine" active={activeSection === 'telemedicine'}
                    onClick={() => setActiveSection('telemedicine')} compact={!sidebarOpen} />
                </>
              )}
              {userRole === 'doctor' && (
                <>
                  <NavItem icon={<Activity />} label="Overview" active={activeSection === 'overview'}
                    onClick={() => setActiveSection('overview')} compact={!sidebarOpen} />
                  <NavItem icon={<Calendar />} label="Schedule" active={activeSection === 'appointments'}
                    onClick={() => setActiveSection('appointments')} compact={!sidebarOpen} />
                  <NavItem icon={<Users />} label="Patients" active={activeSection === 'patients'}
                    onClick={() => setActiveSection('patients')} compact={!sidebarOpen} />
                  <NavItem icon={<FileText />} label="Reports" active={activeSection === 'reports'}
                    onClick={() => setActiveSection('reports')} compact={!sidebarOpen} />
                  <NavItem icon={<Video />} label="Telemedicine" active={activeSection === 'telemedicine'}
                    onClick={() => setActiveSection('telemedicine')} compact={!sidebarOpen} />
                </>
              )}
              {userRole === 'admin' && (
                <>
                  <NavItem icon={<Activity />} label="Dashboard" active={activeSection === 'overview'}
                    onClick={() => setActiveSection('overview')} compact={!sidebarOpen} />
                  <NavItem icon={<Users />} label="Users" active={activeSection === 'users'}
                    onClick={() => setActiveSection('users')} compact={!sidebarOpen} />
                  <NavItem icon={<Stethoscope />} label="Doctors" active={activeSection === 'doctors'}
                    onClick={() => setActiveSection('doctors')} compact={!sidebarOpen} />
                  <NavItem icon={<Calendar />} label="Appointments" active={activeSection === 'appointments'}
                    onClick={() => setActiveSection('appointments')} compact={!sidebarOpen} />
                  <NavItem icon={<TrendingUp />} label="Analytics" active={activeSection === 'analytics'}
                    onClick={() => setActiveSection('analytics')} compact={!sidebarOpen} />
                </>
              )}
              {userRole === 'guardian' && (
                <>
                  <NavItem icon={<Activity />} label="Overview" active={activeSection === 'overview'}
                    onClick={() => setActiveSection('overview')} compact={!sidebarOpen} />
                  <NavItem icon={<Users />} label="Dependents" active={activeSection === 'dependents'}
                    onClick={() => setActiveSection('dependents')} compact={!sidebarOpen} />
                  <NavItem icon={<Calendar />} label="Appointments" active={activeSection === 'appointments'}
                    onClick={() => setActiveSection('appointments')} compact={!sidebarOpen} />
                  <NavItem icon={<FileText />} label="Records" active={activeSection === 'records'}
                    onClick={() => setActiveSection('records')} compact={!sidebarOpen} />
                  <NavItem icon={<Video />} label="Telemedicine" active={activeSection === 'telemedicine'}
                    onClick={() => setActiveSection('telemedicine')} compact={!sidebarOpen} />
                </>
              )}
            </nav>
          </div>
          <div className="absolute bottom-6 left-6 right-6 flex flex-col gap-3">
            <NavItem icon={<Settings />} label="Settings" compact={!sidebarOpen} />
            <NavItem icon={<LogOut />} label="Logout" compact={!sidebarOpen} />
          </div>
        </div>
      </aside>


      <main className={`transition-all duration-500 ${sidebarOpen ? 'ml-64' : 'ml-20'} p-8 min-h-screen`}>
        <header className="mb-10 flex items-center justify-between">
          <div>
            <h1 className="text-4xl font-extrabold leading-tight tracking-wide">
              Welcome back, {getRoleData()?.name}!
            </h1>
            <p className="mt-2 text-lg text-gray-600 dark:text-gray-300">
              {userRole === 'patient' && "Here's your health summary"}
              {userRole === 'doctor' && "You have 8 appointments today"}
              {userRole === 'admin' && "System overview and analytics"}
              {userRole === 'guardian' && "Monitor your dependents' health"}
            </p>
          </div>
          <div className="flex items-center gap-4">
            <button className="relative p-4 bg-white dark:bg-gray-700 rounded-xl shadow-lg hover:shadow-xl transition">
              <Bell size={24} className="text-gray-600 dark:text-gray-300" />
              <span className="absolute top-3 right-3 w-3 h-3 bg-red-500 rounded-full"></span>
            </button>
            <button
              onClick={() => setDarkMode(!darkMode)}
              className="px-4 py-2 rounded-lg text-base font-semibold bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 shadow-md"
            >
              {darkMode ? "Light Mode" : "Dark Mode"}
            </button>
            <div className={`w-14 h-14 rounded-3xl bg-gradient-to-r ${roleColors[userRole]}
              flex items-center justify-center text-white font-bold text-xl shadow-lg`}>
              {getRoleData()?.name.split(' ').map((n: string) => n[0]).join('')}
            </div>
          </div>
        </header>


        {userRole === 'patient' && (
          activeSection === 'telemedicine' ? (
            <Telemedicine userRole={userRole} />
          ) : activeSection === 'appointments' ? (
            <AppointmentScheduler onBook={(details: any) => {
              console.log('Booked appointment:', details);
            }} />
          ) : activeSection === 'medications' ? (
            <PatientPortal />
          ) : (
            <PatientDashboard data={patientData} activeSection={activeSection} dark={darkMode} />
          )
        )}


        {userRole === 'doctor' && (
          activeSection === 'telemedicine' ? (
            <Telemedicine userRole={userRole} />
          ) : activeSection === 'appointments' ? (
            <AppointmentReceiver doctorId={1} />
          ) : activeSection === 'reports' ? (
            <ReportsSection dark={darkMode} />
          ) : (
            <DoctorDashboard data={doctorData} activeSection={activeSection} dark={darkMode} />
          )
        )}


        {userRole === 'admin' && (
          activeSection === 'appointments' ? (
            <AppointmentScheduler onBook={(details: any) => {
              console.log('Booked appointment:', details);
            }} />
          ) : (
            <AdminDashboard data={adminData} activeSection={activeSection} dark={darkMode} />
          )
        )}


        {userRole === 'guardian' && (
          activeSection === 'telemedicine' ? (
            <Telemedicine userRole={userRole} />
          ) : activeSection === 'appointments' ? (
            <AppointmentScheduler onBook={(details: any) => {
              console.log('Booked appointment:', details);
            }} />
          ) : (
            <GuardianDashboard data={guardianData} activeSection={activeSection} dark={darkMode} />
          )
        )}
      </main>
    </div>
  );
}





function PatientDashboard({ data, activeSection, dark }: any) {
  if (activeSection === 'overview') {
    return (
      <div className="space-y-10">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-7">
          <StatCard icon={<Heart className="text-red-500" />} label="Heart Rate" value={`${data.vitals.heartRate} bpm`} trend="Normal" color="red" darkMode={dark} />
          <StatCard icon={<Activity className="text-blue-500" />} label="Blood Pressure" value={data.vitals.bloodPressure} trend="Optimal range" color="blue" darkMode={dark} />
          <StatCard icon={<Thermometer className="text-orange-500" />} label="Temperature" value={`${data.vitals.temperature}°F`} trend="Normal body temp" color="orange" darkMode={dark} />
          <StatCard icon={<Activity className="text-green-500" />} label="Oxygen Level" value={`${data.vitals.oxygen}%`} trend="Healthy oxygen" color="green" darkMode={dark} />
        </div>
      </div>
    );
  }
  if (activeSection === 'appointments') {
    return (
      <div className="max-w-5xl mx-auto py-16">
        <ApmtLog />
      </div>
    );
  }
  return <div className="text-center text-gray-500 dark:text-gray-400 mt-24">Content for {activeSection}</div>;
}


function DoctorDashboard({ data, activeSection, dark }: any) {
  if (activeSection === 'overview') {
    return (
      <div className="space-y-10">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-7">
          <StatCard icon={<Users className="text-emerald-500" />} label="Today's Patients" value={data.stats.todayPatients} trend="+3 from yesterday" color="emerald" darkMode={dark} />
          <StatCard icon={<FileText className="text-blue-500" />} label="Pending Reports" value={data.stats.pendingReports} trend="2 urgent" color="blue" darkMode={dark} />
          <StatCard icon={<Users className="text-purple-500" />} label="Total Patients" value={data.stats.totalPatients} trend="+12 this month" color="purple" darkMode={dark} />
          <StatCard icon={<TrendingUp className="text-yellow-500" />} label="Rating" value={`${data.stats.rating}/5.0`} trend="Excellent" color="yellow" darkMode={dark} />
        </div>
      </div>
    );
  }
  return <div className="text-center text-gray-500 dark:text-gray-400 mt-24">Content for {activeSection}</div>;
}


function AdminDashboard({ data, activeSection, dark }: any) {
  if (activeSection === 'overview') {
    return (
      <div className="space-y-10">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-7">
          <StatCard icon={<Stethoscope className="text-purple-500" />} label="Total Doctors" value={data.stats.totalDoctors} trend="+2 this week" color="purple" darkMode={dark} />
          <StatCard icon={<Users className="text-blue-500" />} label="Total Patients" value={data.stats.totalPatients} trend="+45 this month" color="blue" darkMode={dark} />
          <StatCard icon={<Calendar className="text-emerald-500" />} label="Appointments" value={data.stats.appointments} trend="Today" color="emerald" darkMode={dark} />
          <StatCard icon={<TrendingUp className="text-pink-500" />} label="Revenue" value={`$${(data.stats.revenue / 1000).toFixed(1)}k`} trend="+8.2% vs last month" color="pink" darkMode={dark} />
        </div>
      </div>
    );
  }
  if (activeSection === 'appointments') {
    return (
      <div className="max-w-5xl mx-auto py-16">
        <ApmtLog />
      </div>
    );
  }
  return <div className="text-center text-gray-500 dark:text-gray-400 mt-24">Content for {activeSection}</div>;
}


function GuardianDashboard({ data, activeSection, dark }: any) {
  if (activeSection === 'overview') {
    return (
      <div className="space-y-10">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
          {data.dependents.map((dep: any, idx: number) => (
            <div key={idx} className={`${dark ? 'bg-gray-800' : 'bg-white'} rounded-3xl shadow-xl p-8`}>
              <div className="flex items-center gap-5 mb-6">
                <div className="w-20 h-20 rounded-2xl bg-gradient-to-r from-orange-500 to-amber-600 flex items-center justify-center text-white font-bold text-3xl shadow-lg">
                  {dep.name.split(' ').map((n: string) => n[0]).join('')}
                </div>
                <div>
                  <h3 className="text-2xl font-semibold text-gray-900 dark:text-white">{dep.name}</h3>
                  <p className="text-gray-600 dark:text-gray-400">{dep.relation} • {dep.age} years old</p>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  }
  return <div className="text-center text-gray-500 dark:text-gray-400 mt-24">Content for {activeSection}</div>;
}


function StatCard({ icon, label, value, trend, color, darkMode }: any) {
  return (
    <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-3xl shadow-xl p-6 hover:scale-105 transition-transform duration-300`}>
      <div className="flex items-center justify-between mb-5">
        <div className={`w-14 h-14 rounded-3xl bg-gradient-to-r from-${color}-500 to-${color}-600 flex items-center justify-center shadow-md`}>
          {icon}
        </div>
        <ChevronRight className="text-gray-400 dark:text-gray-300" size={22} />
      </div>
      <h3 className="text-gray-700 dark:text-gray-300 text-base font-semibold mb-1">{label}</h3>
      <p className="text-3xl font-extrabold text-gray-900 dark:text-white mb-3">{value}</p>
      <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{trend}</p>
    </div>
  );
}
